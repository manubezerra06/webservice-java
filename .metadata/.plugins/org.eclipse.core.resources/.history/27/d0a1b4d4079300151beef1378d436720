package br.edu.qi.webserver.rest.controller;

import java.util.ArrayList;
import java.util.List;

import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.QueryParam;
import javax.ws.rs.core.MediaType;

import br.edu.qi.core.dao.Dao;
import br.edu.qi.core.model.Adocao;
import br.edu.qi.core.model.Animal;
import br.edu.qi.core.model.Instituicao;

@Path("/animais")

public class AnimalService {

	@GET
	@Path("/instituicao/cnpj/{cnpj}")
	@Produces(MediaType.APPLICATION_XML)
	public List<Animal> getPorInstituicaoCnpj(@QueryParam("cpnj") String cnpj) {

		Dao dao = new Dao();

		List<Animal> animais = dao.retornarTodos("Animal");

		List<Animal> retorno = new ArrayList<>();

		for (Animal animal : animais) {
			Adocao a = animal.getAdocao();

			if (a != null) {

				Instituicao i = a.getInstituicao();

				if (i != null) {

					if (i.getCnpj().equals(cnpj))
						retorno.add(animal);
				}

			}
		}

		return retorno;
	}

	@GET
	@Path("/instituicao/nome/{nome}")
	@Produces(MediaType.APPLICATION_XML)
	public List<Animal> getPorInstituicaoNome(@QueryParam("nome") String nome) {

		Dao dao = new Dao();

		List<Animal> animais = dao.retornarTodos("Animal");

		List<Animal> retorno = new ArrayList<>();

		for (Animal animal : animais) {
			Adocao a = animal.getAdocao();

			if (a != null) {

				Instituicao i = a.getInstituicao();

				if (i != null) {

					if (i.getNome().equals(nome))
						retorno.add(animal);
				}

			}
		}

		return retorno;
	}

	@GET
	@Path("/nao-adotados")
	@Produces(MediaType.APPLICATION_XML)
	public List<Animal> getAnimaisNaoAdotados() {

		Dao dao = new Dao();
		List<Animal> animais = dao.retornarTodos("Animal");

		List<Animal> retorno = new ArrayList<>();

		for (Animal animal : animais) {
			Adocao a = animal.getAdocao();

			if (a == null) {
				retorno.add(animal);
			}
		}

		return retorno;
	}

}
